<!DOCTYPE html>
<html lang="en">
<head>
    <!-- force refresh -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="default">
    <title>Kapri - Baby Tracker</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'SF Pro Display', 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(180deg, #FFE7DC 0%, #FFF3ED 100%);
            min-height: 100vh;
            padding-bottom: 90px;
            overflow-x: hidden;
        }

        .app-container {
            max-width: 420px;
            margin: 0 auto;
            min-height: 100vh;
        }

        /* Page Header */
        .page-header {
            padding: 16px 16px 12px;
        }

        .page-title {
            font-size: 28px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 4px;
        }

        .page-subtitle {
            font-size: 15px;
            color: #6B7280;
            font-weight: 400;
        }

        /* Quick Action Tiles */
        .action-tile {
            background: #FFFFFF;
            border: none;
            border-radius: 16px;
            padding: 16px 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
            color: #6B7280;
        }

        .action-tile svg {
            color: #6B7280;
        }

        .action-tile span {
            font-size: 13px;
            font-weight: 600;
        }

        .action-tile.active {
            background: #FF7A45;
            color: #FFFFFF;
        }

        .action-tile.active svg {
            color: #FFFFFF;
        }

        .action-tile:active {
            transform: scale(0.96);
        }

        /* Legacy quick chips - keep for other pages if needed */
        .quick-actions {
            display: flex;
            gap: 8px;
            padding: 0 16px 16px;
            overflow-x: auto;
            -webkit-overflow-scrolling: touch;
        }

        .quick-actions::-webkit-scrollbar {
            display: none;
        }

        .quick-chip {
            flex-shrink: 0;
            background: #FFFFFF;
            border: none;
            border-radius: 12px;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 15px;
            font-weight: 600;
            color: #111827;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 8px rgba(0,0,0,0.04);
        }

        .quick-chip.active {
            background: #FF7A45;
            color: #FFFFFF;
        }

        .quick-chip:active {
            transform: scale(0.96);
        }

        /* Card */
        .card {
            background: #FFFFFF;
            border-radius: 24px;
            padding: 20px;
            margin: 0 16px 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .card-title {
            font-size: 18px;
            font-weight: 700;
            color: #111827;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }

        .stat-box {
            background: #FFF3ED;
            border-radius: 16px;
            padding: 16px;
            text-align: center;
        }

        .stat-number {
            font-size: 32px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 13px;
            color: #6B7280;
            font-weight: 500;
        }

        /* Form Row */
        .form-row {
            background: #F9FAFB;
            border-radius: 12px;
            padding: 14px 16px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
        }

        .form-row-label {
            font-size: 15px;
            color: #6B7280;
            font-weight: 500;
        }

        .form-row-value {
            font-size: 15px;
            color: #111827;
            font-weight: 600;
        }

        .form-row select {
            padding-right: 20px;
            appearance: none;
            -webkit-appearance: none;
            background-image: url('data:image/svg+xml,<svg width="12" height="8" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M1 1.5L6 6.5L11 1.5" stroke="%23111827" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>');
            background-repeat: no-repeat;
            background-position: right center;
        }

        input[type="time"],
        input[type="number"],
        select {
            background: transparent;
            border: none;
            font-size: 15px;
            color: #111827;
            font-weight: 600;
            text-align: right;
            font-family: inherit;
        }

        input:focus, select:focus {
            outline: none;
        }

        /* Toggle Buttons - iOS Segmented Control Style */
        .toggle-group {
            display: flex;
            gap: 0;
            margin-bottom: 12px;
            background: #F3F4F6;
            border-radius: 10px;
            padding: 2px;
        }

        .toggle-btn {
            flex: 1;
            background: transparent;
            border: none;
            border-radius: 8px;
            padding: 10px;
            font-size: 15px;
            font-weight: 600;
            color: #6B7280;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toggle-btn.active {
            background: #FFFFFF;
            color: #111827;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        /* Primary Button */
        .btn-primary {
            width: 100%;
            background: #FF7A45;
            border: none;
            border-radius: 14px;
            padding: 16px;
            font-size: 17px;
            font-weight: 600;
            color: #FFFFFF;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .btn-primary:active {
            transform: scale(0.98);
            background: #F35D2A;
        }

        .btn-secondary {
            width: 100%;
            background: #F9FAFB;
            border: none;
            border-radius: 14px;
            padding: 16px;
            font-size: 17px;
            font-weight: 600;
            color: #111827;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 8px;
        }

        .btn-secondary:active {
            transform: scale(0.98);
        }

        /* Entry List */
        .entry-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .entry-item {
            background: #F9FAFB;
            border-radius: 12px;
            padding: 14px 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .entry-info {
            flex: 1;
        }

        .entry-time {
            font-size: 15px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 2px;
        }

        .entry-detail {
            font-size: 13px;
            color: #6B7280;
        }

        .delete-btn {
            background: rgba(239, 68, 68, 0.1);
            border: none;
            border-radius: 8px;
            padding: 6px 10px;
            font-size: 13px;
            color: #EF4444;
            font-weight: 600;
            cursor: pointer;
        }

        /* Tips Category Tabs */
        .category-tabs {
            display: flex;
            gap: 8px;
            overflow-x: auto;
            margin-bottom: 16px;
            -webkit-overflow-scrolling: touch;
        }

        .category-tabs::-webkit-scrollbar {
            display: none;
        }

        .category-tab {
            flex-shrink: 0;
            background: #F9FAFB;
            border: none;
            border-radius: 10px;
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 600;
            color: #6B7280;
            cursor: pointer;
            transition: all 0.2s;
        }

        .category-tab.active {
            background: #FF7A45;
            color: #FFFFFF;
        }

        .tip-card {
            background: #FFF3ED;
            border-radius: 20px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .tip-title {
            font-size: 16px;
            font-weight: 700;
            color: #111827;
            margin-bottom: 12px;
        }

        .tip-card ul {
            list-style: none;
            padding: 0;
        }

        .tip-card li {
            font-size: 14px;
            color: #4B5563;
            line-height: 1.6;
            margin-bottom: 8px;
            padding-left: 16px;
            position: relative;
        }

        .tip-card li:before {
            content: "‚Ä¢";
            position: absolute;
            left: 0;
            color: #FF7A45;
            font-weight: 700;
        }

        /* Weekly Summary */
        .summary-card {
            background: linear-gradient(135deg, #FF7A45 0%, #F35D2A 100%);
            border-radius: 24px;
            padding: 24px;
            color: #FFFFFF;
            margin-bottom: 12px;
        }

        .summary-label {
            font-size: 14px;
            opacity: 0.9;
            margin-bottom: 8px;
        }

        .summary-amount {
            font-size: 40px;
            font-weight: 700;
            margin-bottom: 16px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-top: 1px solid rgba(255,255,255,0.2);
            font-size: 15px;
        }

        .summary-row:first-child {
            border-top: none;
        }

        /* Bottom Navigation */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #FFFFFF;
            border-radius: 24px 24px 0 0;
            padding: 12px 8px 24px;
            display: flex;
            justify-content: space-around;
            box-shadow: 0 -4px 20px rgba(0,0,0,0.08);
            max-width: 420px;
            margin: 0 auto;
        }

        .nav-item {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            padding: 8px;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            color: #9CA3AF;
        }

        .nav-item svg {
            color: #9CA3AF;
        }

        .nav-item.active {
            background: #FF7A45;
            color: #FFFFFF;
        }

        .nav-item.active svg {
            color: #FFFFFF;
        }

        .nav-label {
            font-size: 11px;
            font-weight: 600;
            color: inherit;
        }

        /* Page Visibility */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        #welcomePage {
            display: none;
        }

        #welcomePage.active {
            display: block;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: #9CA3AF;
            font-size: 15px;
        }

        /* Date Display */
        .date-badge {
            background: #F9FAFB;
            border-radius: 10px;
            padding: 8px 14px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            font-size: 14px;
            font-weight: 600;
            color: #111827;
            margin-bottom: 16px;
        }

        /* Responsive */
        @media (min-width: 421px) {
            .app-container {
                padding: 0 env(safe-area-inset-left) 0 env(safe-area-inset-right);
            }
        }
    </style>
</head>
<body>
    <div class="app-container">
        <!-- WELCOME SCREEN -->
        <div id="welcomePage" class="page">
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 80vh; padding: 40px 16px;">
                <div style="width: 280px; height: 280px; border-radius: 50%; background: #FFFFFF; display: flex; align-items: center; justify-content: center; margin-bottom: 40px; box-shadow: 0 10px 30px rgba(0,0,0,0.08);">
                    <svg width="160" height="160" viewBox="0 0 160 160" fill="none">
                        <circle cx="80" cy="60" r="30" fill="#FFE7DC"/>
                        <circle cx="80" cy="140" r="50" fill="#FFE7DC"/>
                        <circle cx="65" cy="55" r="4" fill="#FF7A45"/>
                        <circle cx="95" cy="55" r="4" fill="#FF7A45"/>
                        <path d="M70 70 Q80 75 90 70" stroke="#FF7A45" stroke-width="3" stroke-linecap="round" fill="none"/>
                    </svg>
                </div>
                <h1 style="font-size: 36px; font-weight: 700; color: #111827; margin-bottom: 12px;">Welcome</h1>
                <p style="font-size: 16px; color: #6B7280; text-align: center; margin-bottom: 48px; line-height: 1.5;">To Baby Track ‚Äì Every Moment,<br>Safety and Health.</p>
                <button class="btn-primary" onclick="startApp()" style="max-width: 280px;">Get Started</button>
            </div>
        </div>

        <!-- HOME PAGE -->
        <div id="homePage" class="page active">
            <div style="padding: 16px; display: flex; align-items: center; justify-content: space-between;">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="width: 48px; height: 48px; border-radius: 50%; background: linear-gradient(135deg, #FF7A45 0%, #F35D2A 100%); display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 20px;">K</div>
                    <div>
                        <div style="font-size: 20px; font-weight: 700; color: #111827;">Kapri</div>
                        <div style="font-size: 13px; color: #6B7280;" id="babyAge"></div>
                    </div>
                </div>
                <button style="width: 40px; height: 40px; border-radius: 50%; background: #FFFFFF; border: none; display: flex; align-items: center; justify-content: center; cursor: pointer; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                    <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                        <path d="M2 6h16M2 10h16M2 14h16" stroke="#111827" stroke-width="2" stroke-linecap="round"/>
                    </svg>
                </button>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2 class="card-title">Today's Summary</h2>
                </div>
                <div class="date-badge">
                    <span id="todayDateHome"></span>
                </div>
                <div class="stats-grid">
                    <div class="stat-box">
                        <div class="stat-number" id="todayFeedings">0</div>
                        <div class="stat-label">Feedings</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="todayDiapers">0</div>
                        <div class="stat-label">Diapers</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="weekHours">0</div>
                        <div class="stat-label">Hours This Week</div>
                    </div>
                    <div class="stat-box">
                        <div class="stat-number" id="weekEarnings">$0</div>
                        <div class="stat-label">Earnings</div>
                    </div>
                </div>
            </div>

            <div class="card">
                <div class="card-title" style="margin-bottom: 12px;">Recent Activity</div>
                <div id="recentActivity" style="display: flex; flex-direction: column; gap: 8px;"></div>
            </div>
        </div>

        <!-- FEEDING PAGE -->
        <div id="feedingPage" class="page">
            <div class="page-header">
                <h1 class="page-title">Feeding</h1>
                <p class="page-subtitle">Log baby's feeding</p>
            </div>

            <div class="card">
                <div class="date-badge">
                    <span id="feedingDate"></span>
                </div>

                <div class="form-row">
                    <span class="form-row-label">Time</span>
                    <input type="time" id="feedTime" class="form-row-value">
                </div>

                <div class="form-row">
                    <span class="form-row-label">Amount (oz)</span>
                    <input type="number" id="feedAmount" step="0.5" placeholder="0" class="form-row-value">
                </div>

                <div class="form-row">
                    <span class="form-row-label">Type</span>
                    <select id="feedType" class="form-row-value">
                        <option value="Bottle">Bottle</option>
                        <option value="Breast">Breast</option>
                        <option value="Solid Food">Solid Food</option>
                        <option value="Snack">Snack</option>
                    </select>
                </div>

                <button class="btn-primary" onclick="addFeeding()">Save</button>
            </div>

            <div class="card">
                <div class="card-title">Today's Feedings</div>
                <div id="feedingList" class="entry-list"></div>
            </div>
        </div>

        <!-- DIAPER PAGE -->
        <div id="diaperPage" class="page">
            <div class="page-header">
                <h1 class="page-title">Diaper</h1>
                <p class="page-subtitle">Log diaper change</p>
            </div>

            <div class="card">
                <div class="date-badge">
                    <span id="diaperDate"></span>
                </div>

                <div class="form-row">
                    <span class="form-row-label">Time</span>
                    <input type="time" id="diaperTime" class="form-row-value">
                </div>

                <div style="margin: 12px 0 4px; font-size: 13px; color: #6B7280; font-weight: 500;">Type</div>
                <div class="toggle-group">
                    <button class="toggle-btn active" data-type="wet">Wet</button>
                    <button class="toggle-btn" data-type="dirty">Dirty</button>
                    <button class="toggle-btn" data-type="both">Both</button>
                </div>

                <button class="btn-primary" onclick="addDiaper()">Save</button>
            </div>

            <div class="card">
                <div class="card-title">Today's Changes</div>
                <div id="diaperList" class="entry-list"></div>
            </div>
        </div>

        <!-- TIPS PAGE -->
        <div id="tipsPage" class="page">
            <div class="page-header">
                <h1 class="page-title">Tips & Guidance</h1>
                <p class="page-subtitle">Care instructions for Kapri</p>
            </div>

            <div style="padding: 0 16px;">
                <div class="category-tabs">
                    <button class="category-tab active" onclick="filterTips('all', this)">All</button>
                    <button class="category-tab" onclick="filterTips('feeding', this)">Feeding</button>
                    <button class="category-tab" onclick="filterTips('crying', this)">Crying</button>
                    <button class="category-tab" onclick="filterTips('diaper', this)">Diaper</button>
                    <button class="category-tab" onclick="filterTips('nap', this)">Nap</button>
                </div>
            </div>

            <div id="tipsContainer">
                <div class="card tip-card" data-category="feeding">
                    <div class="tip-title">Feeding</div>
                    <ul>
                        <<li>Bottles and formula will always be prepped.</li>
<li>Just in case bottle: 4 oz of water and 2 scoops of formula.</li>
<li>Do not feed before 3 hours since last feed.</li>
<li>If she is sleeping, do not wake her.</li>
<li>When she wakes: change diaper, then feed.</li>
<li>Hold her slightly upright while feeding.</li>
<li>Try to burp every 20 seconds. It is okay if she does not burp.</li>
<li>If she is crying, keep feeding.</li>
                </div>

                <div class="card tip-card" data-category="crying">
                    <div class="tip-title">If Crying</div>
                    <ul>
                        <li>If 3 hours since last feed, give bottle.</li>
<li>Check diaper. She does not like a pooped diaper.</li>
<li>Bounce, walk, or rock her. She mainly wants to be held.</li>
<li>Give her a minute to calm.</li>
<li>Do not lay her down or place her in the bouncer if she is crying.</li>
<li>If awake and crying, lay her on her side.</li>
<li>If on her back, watch in case she spits up.</li>
<li>If she is choking or coughing, do not panic.</li>
<li>Pat her back and give her a second to catch her breath.</li>
                    </ul>
                </div>

                <div class="card tip-card" data-category="diaper">
                    <div class="tip-title">Diaper</div>
                    <ul>
                        <li>Try to change diaper before feeding or if she has pooped.</li>
<li>If her skin looks red, apply diaper cream.</li>
<li>The cream is in the caddy.</li>
                    </ul>
                </div>

                <div class="card tip-card" data-category="nap">
                    <div class="tip-title">Nap</div>
                    <ul>
                        <li>Dark curtains, noise machine, white noise</li>
                        <li>Loose clothing, comfortable temperature</li>
                        <li>Sleep sac if she'll take it - likes facing door</li>
                        <li>Use bassinet for naps - rock if waking up</li>
                        <li>She only likes to lay/nap on her right side</li>
                    </ul>
                </div>

                <div class="card tip-card" data-category="all">
                    <div class="tip-title">Extra Tips</div>
                    <ul>
                        <li>She doesn't really like tummy time yet</li>
                        <li>Burping: lay upright, slight down/up + pat</li>
                        <li>If gas/farting or struggling = burp them</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- PAYMENT PAGE -->
        <div id="paymentPage" class="page">
            <div class="page-header">
                <h1 class="page-title">Payment</h1>
                <p class="page-subtitle">Weekly hours & earnings</p>
            </div>

            <div class="card summary-card">
                <div class="summary-label">Weekly Total</div>
                <div class="summary-amount" id="weeklyTotal">$0.00</div>
                <div class="summary-row">
                    <span>Total Hours</span>
                    <span id="weeklyHours">0 hrs</span>
                </div>
                <div class="summary-row">
                    <span>Hourly Rate</span>
                    <span>$15/hr</span>
                </div>
            </div>

            <div class="card">
                <div class="card-title">Log Hours</div>
                <div class="date-badge">
                    <span id="paymentDate"></span>
                </div>

                <div class="form-row">
                    <span class="form-row-label">Check-in</span>
                    <input type="time" id="checkInTime" class="form-row-value">
                </div>

                <div class="form-row">
                    <span class="form-row-label">Check-out</span>
                    <input type="time" id="checkOutTime" class="form-row-value">
                </div>

                <button class="btn-primary" onclick="addTimeEntry()">Log Hours</button>
            </div>

            <div class="card">
                <div class="card-title">This Week's Entries</div>
                <div id="weeklyEntries" class="entry-list"></div>
            </div>

            <div style="padding: 0 16px 16px;">
                <button class="btn-primary" onclick="generateInvoice()">Generate Invoice</button>
                <button class="btn-secondary" onclick="newWeek()">Start New Week</button>
            </div>
        </div>

        <!-- BOTTOM NAVIGATION -->
        <div class="bottom-nav">
            <div class="nav-item active" data-page="homePage">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                <span class="nav-label">Home</span>
            </div>
            <div class="nav-item" data-page="feedingPage">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M6 2v20M10 8v14M14 14v8M18 11v11" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span class="nav-label">Feed</span>
            </div>
            <div class="nav-item" data-page="diaperPage">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <circle cx="12" cy="12" r="9" stroke="currentColor" stroke-width="2"/>
                    <path d="M12 8v4l3 3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
                <span class="nav-label">Diaper</span>
            </div>
            <div class="nav-item" data-page="tipsPage">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <path d="M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z" stroke="currentColor" stroke-width="2" stroke-linejoin="round"/>
                </svg>
                <span class="nav-label">Tips</span>
            </div>
            <div class="nav-item" data-page="paymentPage">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                    <rect x="3" y="6" width="18" height="13" rx="2" stroke="currentColor" stroke-width="2"/>
                    <path d="M3 10h18" stroke="currentColor" stroke-width="2"/>
                </svg>
                <span class="nav-label">Payment</span>
            </div>
        </div>
    </div>

    <script>
        (function() {
            'use strict';
            
            const HOURLY_RATE = 15;
            const DOB = new Date('2025-11-14'); // Kapri's DOB: November 14, 2025
            let timeEntries = [];
            let feedings = [];
            let diapers = [];
            let selectedDiaperType = 'wet';
            let invoiceCounter = 1;

            // Welcome screen handling
            window.startApp = function() {
                localStorage.setItem('hasStarted', 'true');
                document.getElementById('welcomePage').style.display = 'none';
                document.getElementById('homePage').classList.add('active');
                updateHomeSummary();
            };

            function checkWelcomeScreen() {
                const hasStarted = localStorage.getItem('hasStarted');
                if (hasStarted === 'true') {
                    document.getElementById('welcomePage').style.display = 'none';
                    document.getElementById('homePage').classList.add('active');
                } else {
                    document.getElementById('welcomePage').classList.add('active');
                    document.getElementById('homePage').classList.remove('active');
                }
            }

            // Calculate baby age accurately
            function calculateAge() {
                const now = new Date();
                const birthDate = new Date(DOB);
                
                let years = now.getFullYear() - birthDate.getFullYear();
                let months = now.getMonth() - birthDate.getMonth();
                let days = now.getDate() - birthDate.getDate();
                
                if (days < 0) {
                    months--;
                    const lastMonth = new Date(now.getFullYear(), now.getMonth(), 0);
                    days += lastMonth.getDate();
                }
                
                if (months < 0) {
                    years--;
                    months += 12;
                }
                
                if (months === 0 && days === 0) {
                    return 'Newborn';
                } else if (months === 0) {
                    return `${days} day${days !== 1 ? 's' : ''} old`;
                } else if (days === 0) {
                    return `${months} month${months !== 1 ? 's' : ''} old`;
                } else {
                    return `${months} month${months !== 1 ? 's' : ''} ${days} day${days !== 1 ? 's' : ''} old`;
                }
            }

            function updateBabyAge() {
                const ageElement = document.getElementById('babyAge');
                if (ageElement) {
                    ageElement.textContent = calculateAge();
                }
            }

            // Action tile navigation
            window.navigateFromTile = function(tile) {
                // Remove active from all tiles
                document.querySelectorAll('.action-tile').forEach(t => t.classList.remove('active'));
                // Add active to clicked tile
                tile.classList.add('active');
                // Navigate
                const target = tile.dataset.target;
                navigateTo(target);
            };

            // Load data
            function loadData() {
                try {
                    timeEntries = JSON.parse(localStorage.getItem('timeEntries') || '[]');
                    feedings = JSON.parse(localStorage.getItem('feedings') || '[]');
                    diapers = JSON.parse(localStorage.getItem('diapers') || '[]');
                    invoiceCounter = parseInt(localStorage.getItem('invoiceCounter') || '1');
                } catch (e) {
                    console.error('Error loading data:', e);
                }
            }

            function saveData() {
                localStorage.setItem('timeEntries', JSON.stringify(timeEntries));
                localStorage.setItem('feedings', JSON.stringify(feedings));
                localStorage.setItem('diapers', JSON.stringify(diapers));
                localStorage.setItem('invoiceCounter', invoiceCounter);
            }

            function getTodayString() {
                return new Date().toISOString().split('T')[0];
            }

            function formatDate(date) {
                return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            }

            function formatTime(time) {
                const [hours, minutes] = time.split(':');
                const h = parseInt(hours);
                const ampm = h >= 12 ? 'PM' : 'AM';
                const h12 = h % 12 || 12;
                return h12 + ':' + minutes + ' ' + ampm;
            }

            function updateDateDisplays() {
                const today = new Date();
                const dateStr = formatDate(today);
                document.getElementById('todayDateHome').textContent = dateStr;
                document.getElementById('feedingDate').textContent = dateStr;
                document.getElementById('diaperDate').textContent = dateStr;
                document.getElementById('paymentDate').textContent = dateStr;
            }

            // Navigation
            window.navigateTo = function(pageId) {
                document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
                document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
                
                document.getElementById(pageId).classList.add('active');
                document.querySelector(`[data-page="${pageId}"]`).classList.add('active');
                
                if (pageId === 'homePage') updateHomeSummary();
                if (pageId === 'feedingPage') displayFeedings();
                if (pageId === 'diaperPage') displayDiapers();
                if (pageId === 'paymentPage') updatePaymentPage();
            };

            document.querySelectorAll('.nav-item').forEach(item => {
                item.addEventListener('click', function() {
                    navigateTo(this.dataset.page);
                });
            });

            // Diaper type selection
            document.querySelectorAll('.toggle-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.toggle-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedDiaperType = this.dataset.type;
                });
            });

            // Feeding
            window.addFeeding = function() {
                const time = document.getElementById('feedTime').value;
                const amount = document.getElementById('feedAmount').value;
                const type = document.getElementById('feedType').value;

                if (!time || !amount) {
                    alert('Please fill in all fields');
                    return;
                }

                feedings.push({
                    id: Date.now(),
                    date: getTodayString(),
                    time,
                    amount: parseFloat(amount),
                    type
                });

                saveData();
                displayFeedings();
                updateHomeSummary();
                
                document.getElementById('feedTime').value = '';
                document.getElementById('feedAmount').value = '';
            };

            function displayFeedings() {
                const today = getTodayString();
                const todayFeedings = feedings.filter(f => f.date === today);
                const container = document.getElementById('feedingList');

                if (todayFeedings.length === 0) {
                    container.innerHTML = '<div class="empty-state">No feedings logged today</div>';
                    return;
                }

                container.innerHTML = todayFeedings.map(f => `
                    <div class="entry-item">
                        <div class="entry-info">
                            <div class="entry-time">${formatTime(f.time)}</div>
                            <div class="entry-detail">${f.amount}oz - ${f.type}</div>
                        </div>
                        <button class="delete-btn" onclick="deleteFeeding(${f.id})">Delete</button>
                    </div>
                `).join('');
            }

            window.deleteFeeding = function(id) {
                feedings = feedings.filter(f => f.id !== id);
                saveData();
                displayFeedings();
                updateHomeSummary();
            };

            // Diaper
            window.addDiaper = function() {
                const time = document.getElementById('diaperTime').value;

                if (!time) {
                    alert('Please enter a time');
                    return;
                }

                diapers.push({
                    id: Date.now(),
                    date: getTodayString(),
                    time,
                    type: selectedDiaperType
                });

                saveData();
                displayDiapers();
                updateHomeSummary();
                
                document.getElementById('diaperTime').value = '';
            };

            function displayDiapers() {
                const today = getTodayString();
                const todayDiapers = diapers.filter(d => d.date === today);
                const container = document.getElementById('diaperList');

                if (todayDiapers.length === 0) {
                    container.innerHTML = '<div class="empty-state">No changes logged today</div>';
                    return;
                }

                container.innerHTML = todayDiapers.map(d => `
                    <div class="entry-item">
                        <div class="entry-info">
                            <div class="entry-time">${formatTime(d.time)}</div>
                            <div class="entry-detail">${d.type.charAt(0).toUpperCase() + d.type.slice(1)}</div>
                        </div>
                        <button class="delete-btn" onclick="deleteDiaper(${d.id})">Delete</button>
                    </div>
                `).join('');
            }

            window.deleteDiaper = function(id) {
                diapers = diapers.filter(d => d.id !== id);
                saveData();
                displayDiapers();
                updateHomeSummary();
            };

            // Tips filtering
            window.filterTips = function(category, button) {
                document.querySelectorAll('.category-tab').forEach(tab => {
                    tab.classList.remove('active');
                });
                if (button) {
                    button.classList.add('active');
                }

                document.querySelectorAll('.tip-card').forEach(card => {
                    if (category === 'all' || card.dataset.category === category) {
                        card.style.display = 'block';
                    } else {
                        card.style.display = 'none';
                    }
                });
            };

            // Time tracking
            window.addTimeEntry = function() {
                const checkIn = document.getElementById('checkInTime').value;
                const checkOut = document.getElementById('checkOutTime').value;

                if (!checkIn || !checkOut) {
                    alert('Please enter both times');
                    return;
                }

                const hours = calculateHours(checkIn, checkOut);
                timeEntries.push({
                    id: Date.now(),
                    date: getTodayString(),
                    checkIn,
                    checkOut,
                    hours,
                    amount: hours * HOURLY_RATE
                });

                saveData();
                updatePaymentPage();
                updateHomeSummary();
                
                document.getElementById('checkInTime').value = '';
                document.getElementById('checkOutTime').value = '';
            };

            function calculateHours(start, end) {
                const startDate = new Date('2000-01-01T' + start);
                const endDate = new Date('2000-01-01T' + end);
                const diff = (endDate - startDate) / 1000 / 60;
                const rounded = Math.ceil(diff / 15) * 15;
                return rounded / 60;
            }

            function getMonday() {
                const today = new Date();
                const day = today.getDay();
                const diff = day === 0 ? -6 : 1 - day;
                const monday = new Date(today);
                monday.setDate(today.getDate() + diff);
                monday.setHours(0, 0, 0, 0);
                return monday;
            }

            function getFriday(monday) {
                const friday = new Date(monday);
                friday.setDate(monday.getDate() + 4);
                return friday;
            }

            function updateHomeSummary() {
                const today = getTodayString();
                const todayFeedings = feedings.filter(f => f.date === today).length;
                const todayDiapers = diapers.filter(d => d.date === today).length;
                
                const weekStart = getMonday();
                const weekEnd = getFriday(weekStart);
                const weekEntries = timeEntries.filter(t => {
                    const entryDate = new Date(t.date);
                    return entryDate >= weekStart && entryDate <= weekEnd;
                });
                
                const weekHours = weekEntries.reduce((sum, e) => sum + e.hours, 0);
                const weekEarnings = weekHours * HOURLY_RATE;

                document.getElementById('todayFeedings').textContent = todayFeedings;
                document.getElementById('todayDiapers').textContent = todayDiapers;
                document.getElementById('weekHours').textContent = weekHours.toFixed(1);
                document.getElementById('weekEarnings').textContent = '$' + weekEarnings.toFixed(0);

                updateRecentActivity();
            }

            function updateRecentActivity() {
                const container = document.getElementById('recentActivity');
                
                // Combine all activities with timestamps
                const activities = [];
                
                feedings.forEach(f => {
                    activities.push({
                        type: 'feed',
                        time: new Date(f.date + 'T' + f.time),
                        data: f
                    });
                });
                
                diapers.forEach(d => {
                    activities.push({
                        type: 'diaper',
                        time: new Date(d.date + 'T' + d.time),
                        data: d
                    });
                });
                
                // Sort by most recent
                activities.sort((a, b) => b.time - a.time);
                
                // Take last 5
                const recent = activities.slice(0, 5);
                
                if (recent.length === 0) {
                    container.innerHTML = '<div class="empty-state" style="padding: 20px;">No activities yet today</div>';
                    return;
                }
                
                container.innerHTML = recent.map(activity => {
                    const timeStr = formatTime(activity.data.time);
                    const dateStr = activity.time.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
                    
                    if (activity.type === 'feed') {
                        return `
                            <div class="entry-item">
                                <div class="entry-info">
                                    <div class="entry-time">${timeStr} ‚Ä¢ ${dateStr}</div>
                                    <div class="entry-detail">Fed ${activity.data.amount}oz - ${activity.data.type}</div>
                                </div>
                                <div style="color: #FF7A45; font-size: 20px;">üçº</div>
                            </div>
                        `;
                    } else {
                        return `
                            <div class="entry-item">
                                <div class="entry-info">
                                    <div class="entry-time">${timeStr} ‚Ä¢ ${dateStr}</div>
                                    <div class="entry-detail">${activity.data.type.charAt(0).toUpperCase() + activity.data.type.slice(1)} diaper</div>
                                </div>
                                <div style="color: #FF7A45; font-size: 20px;">üë∂</div>
                            </div>
                        `;
                    }
                }).join('');
            }

            function updatePaymentPage() {
                const weekStart = getMonday();
                const weekEnd = getFriday(weekStart);
                const weekEntries = timeEntries.filter(t => {
                    const entryDate = new Date(t.date);
                    return entryDate >= weekStart && entryDate <= weekEnd;
                });

                const totalHours = weekEntries.reduce((sum, e) => sum + e.hours, 0);
                const totalAmount = totalHours * HOURLY_RATE;

                document.getElementById('weeklyHours').textContent = totalHours.toFixed(1) + ' hrs';
                document.getElementById('weeklyTotal').textContent = '$' + totalAmount.toFixed(2);

                const container = document.getElementById('weeklyEntries');
                if (weekEntries.length === 0) {
                    container.innerHTML = '<div class="empty-state">No entries this week</div>';
                } else {
                    container.innerHTML = weekEntries.map(e => `
                        <div class="entry-item">
                            <div class="entry-info">
                                <div class="entry-time">${new Date(e.date).toLocaleDateString('en-US', {weekday: 'short', month: 'short', day: 'numeric'})}</div>
                                <div class="entry-detail">${formatTime(e.checkIn)} - ${formatTime(e.checkOut)} (${e.hours.toFixed(2)} hrs)</div>
                            </div>
                            <div style="font-weight: 700; color: #111827;">$${e.amount.toFixed(2)}</div>
                        </div>
                    `).join('');
                }
            }

            // Invoice generation
            window.generateInvoice = function() {
                const weekStart = getMonday();
                const weekEnd = getFriday(weekStart);
                const weekEntries = timeEntries.filter(t => {
                    const entryDate = new Date(t.date);
                    return entryDate >= weekStart && entryDate <= weekEnd;
                });

                if (weekEntries.length === 0) {
                    alert('No entries to generate invoice');
                    return;
                }

                const invoiceNumber = 'INV-' + String(invoiceCounter).padStart(3, '0');
                const totalHours = weekEntries.reduce((sum, e) => sum + e.hours, 0);
                const totalAmount = totalHours * HOURLY_RATE;

                const tableRows = weekEntries.map(e => {
                    const date = new Date(e.date);
                    return '<tr><td>' + date.toLocaleDateString('en-US', {weekday: 'short', month: 'short', day: 'numeric'}) + '</td><td>Babysitting - Kapri Odio</td><td>' + formatTime(e.checkIn) + ' - ' + formatTime(e.checkOut) + '</td><td>' + e.hours.toFixed(2) + '</td><td style="text-align: right;">$' + e.amount.toFixed(2) + '</td></tr>';
                }).join('');

                const invoiceHTML = '<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Invoice ' + invoiceNumber + '</title><style>* { margin: 0; padding: 0; box-sizing: border-box; } body { font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", sans-serif; padding: 40px; background: #FFF3ED; } .invoice { max-width: 800px; margin: 0 auto; background: white; padding: 60px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); } .header { display: flex; justify-content: space-between; margin-bottom: 40px; padding-bottom: 30px; border-bottom: 2px solid #FFE7DC; } .invoice-title { font-size: 36px; font-weight: 700; color: #111827; } .invoice-number { text-align: right; color: #6B7280; font-size: 14px; } .parties { display: grid; grid-template-columns: 1fr 1fr; gap: 40px; margin-bottom: 40px; } .party h4 { color: #FF7A45; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 10px; } .party p { color: #111827; line-height: 1.6; font-size: 14px; } table { width: 100%; margin-bottom: 40px; border-collapse: collapse; } thead { background: #FFF3ED; } th { padding: 14px; text-align: left; color: #6B7280; font-weight: 600; font-size: 12px; text-transform: uppercase; } td { padding: 14px; border-bottom: 1px solid #FFE7DC; color: #111827; font-size: 14px; } tbody tr:last-child td { border-bottom: none; } .total { display: flex; justify-content: flex-end; margin-top: 30px; } .total-box { background: linear-gradient(135deg, #FF7A45 0%, #F35D2A 100%); color: white; padding: 30px 40px; border-radius: 16px; min-width: 300px; text-align: center; } .total-label { font-size: 14px; margin-bottom: 8px; opacity: 0.9; } .total-amount { font-size: 42px; font-weight: 700; } @media print { body { background: white; padding: 0; } .invoice { box-shadow: none; } }</style></head><body><div class="invoice"><div class="header"><div class="invoice-title">INVOICE</div><div class="invoice-number"><div><strong>' + invoiceNumber + '</strong></div><div>Date: ' + formatDate(new Date()) + '</div><div>Period: ' + formatDate(weekStart) + ' - ' + formatDate(weekEnd) + '</div></div></div><div class="parties"><div class="party"><h4>Bill To</h4><p><strong>Sam Odio</strong><br>10621 Hammocks Blvd<br>Miami, FL 33196</p></div><div class="party"><h4>Service Provider</h4><p><strong>Natalie Odio</strong><br>10621 Hammocks Blvd<br>Miami, FL 33196</p></div></div><table><thead><tr><th>Date</th><th>Service</th><th>Time</th><th>Hours</th><th style="text-align: right;">Amount</th></tr></thead><tbody>' + tableRows + '</tbody></table><div class="total"><div class="total-box"><div class="total-label">Total Amount Due</div><div class="total-amount">$' + totalAmount.toFixed(2) + '</div></div></div></div></body></html>';

                const newWindow = window.open('', '_blank');
                if (newWindow) {
                    newWindow.document.write(invoiceHTML);
                    newWindow.document.close();
                    invoiceCounter++;
                    saveData();
                } else {
                    alert('Please allow popups');
                }
            };

            window.newWeek = function() {
                if (confirm('Start new week? This will clear all current time entries, feedings, and diapers.')) {
                    timeEntries = [];
                    feedings = [];
                    diapers = [];
                    saveData();
                    updateHomeSummary();
                    updatePaymentPage();
                    displayFeedings();
                    displayDiapers();
                }
            };

            // Initialize
            checkWelcomeScreen();
            loadData();
            updateDateDisplays();
            updateBabyAge();
            updateHomeSummary();
            displayFeedings();
            displayDiapers();
            updatePaymentPage();

            // Set current time
            const now = new Date();
            const timeStr = now.getHours().toString().padStart(2, '0') + ':' + now.getMinutes().toString().padStart(2, '0');
            document.getElementById('feedTime').value = timeStr;
            document.getElementById('diaperTime').value = timeStr;

        })();
    </script>
</body>
</html>
